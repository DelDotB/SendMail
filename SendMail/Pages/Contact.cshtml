@page
@model ContactModel
@using Microsoft.AspNetCore.Mvc.RazorPages
@using MimeKit
@using MailKit.Net.Smtp

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@functions {
public class ContactModel : PageModel
{
	string username = "deldotb@gmail.com";
	string password = "Snarf5Smegma6";
	string emailprivate = "rocooley@utmb.edu";


	public string PostedMessage { get; set; } = "";// init to empty string
	[BindProperty]
	public string name { get; set; }
	[BindProperty]
	public string email { get; set; }
	[BindProperty]
	public string message { get; set; }

	public async Task<IActionResult> OnPostAsync()
	{
		//SendMail(name, email, message);
		return Redirect("/contact/?pb=1");
	}
	public void OnGet(int id)
	{
		if (Request.QueryString.HasValue && Request.QueryString.Value.Contains("pb=1"))
		{
			ViewData["PostedMessage"] = "Your message has been sent [viewdata]";
			PostedMessage = "Your message has been sent!";
		}
	}

	public void SendMail(string name, string email, string messageBody)
	{
		var message = new MimeMessage();
		message.From.Add(new MailboxAddress(name, email));
		message.To.Add(new MailboxAddress("Rodger", emailprivate));
		message.Subject = "testing app";
		message.Body = new TextPart("plain")
		{
			Text = messageBody
		};
		using (var client = new SmtpClient())
		{
			client.Connect("smtp.gmail.com", 587, false);
			client.Authenticate(username, password);
			client.Send(message);
			client.Disconnect(true);

		}

	}

}
}



@{
	ViewData["Title"] = "Contact";
}
<h2>@ViewData["Title"]</h2>
<h3>@Model.PostedMessage</h3>

@*bootstrap*@
<div class="row">
	<div class="col-md-6">
		<form method="post">
			<div class="form-group">
				<label asp-for="name" class="control-label">Name</label>
				<input asp-for="name" class="form-control" />
			</div>
			<div class="form-group">
				<label asp-for="email" class="control-label">E-mail</label>
				<input asp-for="email" class="form-control" />
			</div>
			<div class="form-group">
				<label asp-for="message" class="control-label">Message</label><br />
				<textarea asp-for="message" class="form-control"></textarea>
			</div>
			<button type="submit" value="submit">Submit</button>
		</form>
	</div>
	<div class="col-md-6">

	</div>
</div>


<address>
	One Microsoft Way<br />
	Redmond, WA 98052-6399<br />
	<abbr title="Phone">P:</abbr>
	425.555.0100
</address>

<address>
	<strong>Support:</strong> <a href="mailto:Support@example.com">Support@example.com</a><br />
	<strong>Marketing:</strong> <a href="mailto:Marketing@example.com">Marketing@example.com</a>
</address>
